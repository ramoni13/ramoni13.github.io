<!DOCTYPE html>

<html lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
	<script type="text/javascript" src="//cdns-files.deezer.com/js/min/dz.js"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw==" crossorigin="anonymous">
  	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-hQpvDQiCJaD2H465dQfA717v7lu5qHWtDbWNPvaTJ0ID5xnPUlVXnKzq7b8YUkbN" crossorigin="anonymous">
  	<link href="https://goldenmic-0ff1.restdb.io/assets/css/jquery.datetimepicker.min.css" rel="stylesheet">
	  <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
	  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
	  <script src="https://goldenmic-0ff1.restdb.io/assets/js/jquery-serialize-object.min.js"></script>
	  <script src="https://goldenmic-0ff1.restdb.io/assets/js/jquery.datetimepicker.full.min.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.5.1/lodash.min.js"></script>
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	 <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self' https://www.deezer.com">
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
		.basEcran {
			  height:200px;
			  width:100%;
			  z-index:0;
			  position: relative;
		}
		.separateur {
			  height:50px;
			  width:100%;
			  z-index:0;
			  position: relative;
		}
		.separateur2 {
			  height:10px;
			  width:100%;
			  z-index:0;
			  position: relative;
		}
        .accueil {
		  height:100%;
		  width:100%;
		  background:#59cce0;
		  z-index:0;
		  position: relative;
		}
		/* Shine */
		.accueil:after {
			content:'';
		  top:0;
			transform:translateX(100%);
			width:100%;
			height:100%;
			position: absolute;
			z-index:1;
			animation: slide 1s infinite;
			 
		  /* 
		  CSS Gradient - complete browser support from http://www.colorzilla.com/gradient-editor/ 
		  */
		  background: -moz-linear-gradient(left, rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 50%, rgba(128,186,232,0) 99%, rgba(125,185,232,0) 100%); /* FF3.6+ */
			background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0)), color-stop(50%,rgba(255,255,255,0.8)), color-stop(99%,rgba(128,186,232,0)), color-stop(100%,rgba(125,185,232,0))); /* Chrome,Safari4+ */
			background: -webkit-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(255,255,255,0.8) 50%,rgba(128,186,232,0) 99%,rgba(125,185,232,0) 100%); /* Chrome10+,Safari5.1+ */
			background: -o-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(255,255,255,0.8) 50%,rgba(128,186,232,0) 99%,rgba(125,185,232,0) 100%); /* Opera 11.10+ */
			background: -ms-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(255,255,255,0.8) 50%,rgba(128,186,232,0) 99%,rgba(125,185,232,0) 100%); /* IE10+ */
			background: linear-gradient(to right, rgba(255,255,255,0) 0%,rgba(255,255,255,0.8) 50%,rgba(128,186,232,0) 99%,rgba(125,185,232,0) 100%); /* W3C */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#00ffffff', endColorstr='#007db9e8',GradientType=1 ); /* IE6-9 */
		}
		/* animation */

		@keyframes slide {
			0% {transform:translateX(-100%);}
			100% {transform:translateX(100%);}
		}
		
        table {
            border: 0px solid;
        }

        td {
            border: 1px solid;
            width: 50px;
            height: 50px;
            text-align: left;
			font-family: fantasy;
			font-size: large;
        }
		.progressbarplay {
			cursor:pointer;overflow: hidden;height: 8px;margin-bottom: 8px;background-color: #F7F7F7;background-image: -moz-linear-gradient(top,whiteSmoke,#F9F9F9);background-image: -ms-linear-gradient(top,whiteSmoke,#F9F9F9);background-image: -webkit-gradient(linear,0 0,0 100%,from(whiteSmoke),to(#F9F9F9));background-image: -webkit-linear-gradient(top,whiteSmoke,#F9F9F9);background-image: -o-linear-gradient(top,whiteSmoke,#F9F9F9);background-image: linear-gradient(top,whiteSmoke,#F9F9F9);background-repeat: repeat-x;filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#f5f5f5',endColorstr='#f9f9f9',GradientType=0);-webkit-box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);-moz-box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);-webkit-border-radius: 6px;-moz-border-radius: 6px;border-radius: 6px;
		}
		.progressbarplay .bar {
			cursor:pointer;background: #4496C6;width: 0;height: 8px;color: white;font-size: 12px;text-align: center;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);-webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);-moz-box-shadow: inset 0 -1px 0 rgba(0,0,0,0.15);box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;-webkit-transition: width .6s ease;-moz-transition: width .6s ease;-ms-transition: width .6s ease;-o-transition: width .6s ease;transition: width .6s ease;
		}
    </style>
    <meta charset="utf-8" />
    <title></title>
<script type="text/javascript">
   
	
 
</script>
</head>
<body onload="init();">
<form role="form" id="titres-form">
<center>
	<input type="button" value="Débloquer" onclick="window.open('http://cors-anywhere.herokuapp.com/corsdemo', '_blank');">
	<div id="dz-root"></div>
	<div id="player" style="width:100%;" align="center"></div>
	<br/>
	<div id="slider_seek" class="progressbarplay" style="">
	  <div class="bar" style="width: 0%;"></div>
	</div>
	<!-- CHARGEMENT -->
	<div id="chargement">
		<div class="badge bg-primary" style="font-size: xx-large;">
		Chargement en cours...
		</div>
	</div>
	
	<!-- ACCUEIL -->
	<div id="accueil" onclick="menu('nomEquipes')" hidden="hidden">
		<div class="accueil">
			<img src="logo.png">
		</div>
		<div class="basEcran">
			&nbsp;
		</div>
		<div class="basEcran">
			<button type="button" onclick="menu('nomEquipes')" class="btn btn-success">Allez c'est parti !</button>
		</div>
	</div>
	
	<!-- NOM EQUIPES -->
	<div id="nomEquipes" hidden="hidden">
		<div class="input-group mb-3">
		  <input type="text" class="form-control" id="nomEq1" placeholder="Equipe 1" aria-label="Equipe 1">
		  <span class="input-group-text">VS</span>
		  <input type="text" class="form-control" id="nomEq2" placeholder="Equipe 2" aria-label="Equipe 2">
		</div>
		<div class="basEcran">
			<button type="button" onclick="menu('choixPack')" class="btn btn-success">Valider</button>
		</div>
	</div>
	
	<!-- INFOS JEU -->
	<div id="infosJeu" hidden="hidden">
		<button type="button" class="btn btn-primary" id="IJ_nom_equipe1" style='font-size:xx-large'>
		
		</button>
		<button type="button" class="btn btn-primary" id="IJ_pts_equipe1" style='font-size:xx-large'>
		</button>
		
		<div class="badge bg-ligth" style="font-size: xx-large;">|</div>
		
		<button type="button" class="btn btn-danger" id="IJ_pts_equipe2" style='font-size:xx-large'>
		</button>
		<button type="button" class="btn btn-danger" id="IJ_nom_equipe2" style='font-size:xx-large'>
		</button>
		<HR>
		<button type="button" class="w3-btn w3-blue w3-round-xxlarge" id="switch_eq1_btn" onclick="switche(0)">SWITCH</button>
		<button type="button" class="w3-btn w3-blue w3-round-xxlarge" id="fois2_eq1_btn" onclick="fois2(0)">X2</button>
		<button type="button" class="w3-btn w3-blue w3-round-xxlarge" id="initiales_eq1_btn" onclick="initiales(0)">INITIALES</button>
		<button type="button" class="w3-btn w3-blue w3-round-xxlarge" id="deuxmots_eq1_btn" onclick="deuxMots(0)">2 Mots</button>
		<button type="button" class="w3-btn w3-blue w3-round-xxlarge" id="unmot_eq1_btn" onclick="unmot(0)">1er Mot</button>
		<button type="button" class="w3-btn w3-blue w3-round-xxlarge" id="apeupres_eq1_btn" onclick="apeupres(0)">A peu près</button>
		
		<div class="badge bg-ligth" style="font-size: xx-large;">|</div>
		
		<button type="button" class="w3-btn w3-red w3-round-xxlarge" id="apeupres_eq2_btn" onclick="apeupres(1)">A peu près</button>
		<button type="button" class="w3-btn w3-red w3-round-xxlarge" id="unmot_eq2_btn" onclick="unmot(1)">1er Mot</button>
		<button type="button" class="w3-btn w3-red w3-round-xxlarge" id="deuxmots_eq2_btn" onclick="deuxMots(1)">2 Mots</button>
		<button type="button" class="w3-btn w3-red w3-round-xxlarge" id="initiales_eq2_btn" onclick="initiales(1)">INITIALES</button>
		<button type="button" class="w3-btn w3-red w3-round-xxlarge" id="fois2_eq2_btn" onclick="fois2(1)">X2</button>
		<button type="button" class="w3-btn w3-red w3-round-xxlarge" id="switch_eq2_btn" onclick="switche(1)">SWITCH</button>
		<hr>
	</div>
	
	<!-- MOTS JUSTE AVANT -->
	<div class="badge bg-primary" onclick="" style="font-size: xx-large;" id="justeAvant" hidden="hidden"></div>
	
	<!-- CHOIX PACK -->
	<div id="choixPack" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;">
			Choix du Pack
		</div>
		<div class="separateur">
			&nbsp;
		</div>
		<div id="listeDesPacks"></div>
	</div>
		
	<!-- CHOIX CHANSON -->
	<div id="choixChanson" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;" id="nbMots">
		</div>
		<div class="separateur">
			&nbsp;
		</div>
		<div id="listeChansons"></div>
	</div>
	
	<!-- SWITCH -->
	<div id="proposeSwitch" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;" id="libelleSwitch">
		</div>
		<div id="chansonSwitch"></div>
		<div class="badge bg-primary" style="font-size: xx-large;" id="libelleSwitch2">
		</div>
		<div id="chansonSwitch2"></div>
		<div><button type="button" onclick="resetBtnSwitch()" class="btn btn-success" 
		style="font-size:xx-large">Ne PAS SWITCHER
		</button></div>
	</div>
	
	<!-- BONUS 1 MOT et INITIALES -->
	<div id="bonusUNMOTINITIALES" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;" id="libelleUnMotInitiales">
		Confirmez l'utilisation du Bonus (équipe adverse ne doit pas regarder)<BR>ou Annulez
		</div>
		<div>
			<button type="button" hidden="hidden" id="btnUnMot" onclick="afficheUnMot()" class="btn btn-success" 
			style="font-size:xx-large">AFFICHER 1er MOT</button>
		</div>
		<div>
			<button type="button" hidden="hidden" id="btnInitiales" onclick="afficheInitiales()" class="btn btn-success" 
			style="font-size:xx-large">AFFICHER INITIALES</button>
		</div>
		<div>
		<button type="button" id="btnAnnulerUnMotInitiales" onclick="annulerUnMotInitiales()" class="btn btn-basic" 
			style="font-size:xx-large">ANNULER</button>
		</div>
		<div>
		<div class="badge bg-primary" hidden="hidden" id="reponseUnMotInitiales" style="font-size: xx-large;" >
		</div>
		<div hidden="hidden" id="btnRetourJeuUnMotInitiales">
		<button type="button"  onclick="retourJeuUnMotInitiales()" class="btn btn-success" 
			style="font-size:xx-large">DONNER SA REPONSE</button>
		</div>
		</div>
	</div>
	
	<!-- A PEU PRES -->
	<div id="bonusAPEUPRES" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;" id="libelleUnMotInitiales">
		Ce bonus vous permet d'avoir 1 mot en erreur de la solution.<BR>
		Confirmez l'utilisation du "A peu près" ou Annulez
		</div>
		<div >
			<img src="apeupres.jpg">
		</div>
		<div>
			<button type="button" onclick="confirmerApeupres()" class="btn btn-success" 
			style="font-size:xx-large">A peu près</button>
		</div>
		<div>
		<button type="button" onclick="btnAnnulerApeupres()" 
		class="btn btn-basic" style="font-size:xx-large">ANNULER</button>
		</div>
	</div>
	
	<!-- BONUS X2 -->
	<div id="bonusFOIS2" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;" id="libelleUnMotInitiales">
		Confirmez l'utilisation du X2 ou Annulez
		</div>
		<div>
			<button type="button" onclick="confirmerFois2()" class="btn btn-success" 
			style="font-size:xx-large">X2</button>
		</div>
		<div>
		<button type="button" onclick="btnAnnulerFois2()" 
		class="btn btn-basic" style="font-size:xx-large">ANNULER</button>
		</div>
	</div>
	
	<!-- BONUS 2 MOTS -->
	<div id="bonus2Mots" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;" id="libelle2Mots">
		Sélectionnez 2 Mots ou Annulez
		</div>
		<BR>
		<div class="badge bg-primary" id="listeMots" style="font-size: xx-large;" >
		</div>
		<BR>
		<div>
		<button type="button" id="btnValider2Mots" onclick="btnValider2Mots2()" class="btn btn-success" style="font-size:xx-large">VALIDER</button>
		</div>
		
		<div>
		<button type="button" id="btnAnnuler2Mots" onclick="btnAnnuler2Mots2()" class="btn btn-basic" style="font-size:xx-large">ANNULER</button>
		</div>
		
		<div hidden="hidden" id="btnRetourJeuDeuxMotsInitiales">
		<button type="button"  onclick="retourJeuDeuxMotsInitiales2()" class="btn btn-success" 
			style="font-size:xx-large">DONNER SA REPONSE</button>
		</div>
	</div>
	
	<!-- CHOIX NIVEAU -->
	<div id="niveauChanson" hidden="hidden">
		<div class="badge bg-primary" style="font-size: xx-large;" >Choix Niveau Difficulté</div>
		<div class="badge bg-primary" style="font-size: x-large;" id="infoChansonEncours"></div>
		<div class="separateur">
			&nbsp;
		</div>
		<div><button type="button" onclick="choixNiveau(1)" id="niv1" class="btn btn-primary" style="font-size:xx-large">Facile (X1)
		</button></div>
		<div class="separateurniv2">
			&nbsp;
		</div>
		<div><button type="button" onclick="choixNiveau(2)" id="niv2" class="btn btn-warning" style="font-size:xx-large">Moyen (X2)
		</button></div>
		<div class="separateurniv3">
			&nbsp;
		</div>
		<div><button type="button" onclick="choixNiveau(3)" id="niv3" class="btn btn-danger" style="font-size:xx-large">Dur (X3)
		</button></div>
	</div>
	
	<!-- ECOUTE CHANSON -->
	<div id="ecouteChanson" hidden="hidden">
		<div class="badge bg-primary" onclick="" style="font-size: xx-large;" id="timer">0:00</div>
		<div class="separateur2">
			&nbsp;
		</div>
		<div class="badge bg-primary" onclick="" style="font-size: xx-large;" id="infoChanson"></div>
		<div class="separateur2">
			&nbsp;
		</div>
		<div id="laChanson" onclick=""></div>
	</div>
	
	
	
	<!-- MENU CHANSON -->
	<div id="menuChanson" hidden="hidden">
		<div>
			<button type="button" onclick="rewind()" class="btn btn-success" style="font-size:xx-large">Rewind 15'</button>
			&nbsp;&nbsp;&nbsp;&nbsp;
			<button type="button" onclick="menu('reponse')" class="btn btn-success" style="font-size:xx-large">BONUS & Réponses</button>
		</div>
	</div>
	
	<!-- REPONSE -->
	<div id="reponse" hidden="hidden">
		<div class="btn btn-primary" style="font-size: x-large;" id="infoRepChanson"></div>
		<div class="separateur">
			&nbsp;
		</div>
		<div class="input-group mb-3">
		  <input type="text" class="form-control" id="repEq" placeholder="Reponse" aria-label="Reponse">
		</div>
		<div class="basEcran">
			<button type="button" onclick="bloqueParoles()" class="btn btn-success">On bloque les paroles !</button>
		</div>
	</div>
	
	<!-- VERIFICATION -->
	<div id="verification" hidden="hidden">
		
		<div class="btn btn-primary" style="font-size: xx-large;" id="infoRep1"></div>
		
		<div class="btn btn-danger" style="font-size: xx-large;" id="infoRep2"></div>
		<BR>
		<div id="btnRep1" style="display: inline; visibility: hidden">
			<button type="button" onclick="bonnereponse(0)" class="btn btn-primary" style="display: inline">Bonne Réponse !</button>
		</div>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<div id="btnRep2" style="display: inline; visibility: hidden">
			<button type="button" onclick="bonnereponse(1)" class="btn btn-danger" style="display: inline">Bonne Réponse !</button>
		</div>
		<HR>
		<div class="badge bg-primary" style="font-size: xx-large;" id="infoRep" hidden="hidden"></div>
		<div  hidden="hidden" id="btnRep" >
			<button type="button" onclick="bonnereponse(-1)" class="btn btn-success">Aucune Bonne Réponse</button>
		</div>
	</div>
	
	<!-- VERIFICATION -->
	<div id="chansonSuivante" hidden="hidden">
		<div class="btn btn-default" style="font-size: xx-large;font-weight: bold;" id="infoGagnant"></div>
		<div class="separateur">
			&nbsp;
		</div>
		<div  >
			<button type="button" onclick="menu('prochaineSuivante')" class="btn btn-success">Prochaine chanson !</button>
		</div>
	</div>
	
</center>
<script>
	var divEncours = "chargement";
	var nomEquipe = [];
	var ptsEquipe = [];
	ptsEquipe[0] = 0;
	ptsEquipe[1] = 0;
	var equipeEnCours = 0;
	var nbMotsEnCours = 1;
	var niveauEnCours = 0;
	var ptsEnCours = 0;
	var idTrackEnCours;
	var stopEnCours;
	var solutionStop;
	var motsAvantStop;
	var idChansonEnCours;
	var chansonDejaJouee = [];
	var nomPackEnCours = "";
	var bonusFoisDeux = [2];
	var bonusApeupres = [2];
	var foisDeuxEncours = -1;
	var ApeupresEncours = -1;
	var bonusSwitch = [2];
	var bonusInitiales = [2];
	var bonusPremierMot = [2];
	var bonusDeuxMots = [2];
	var mot1 = -1;
	var mot2 = -1;
	var allRecords = [];
	var allThemes = [];
	var infosPack = [];
	var nbManches = 0;
	var nbManchesEncours = 1;
	var listeChansons = [];
	var reponses = [];
	var tps;
	var tpsencours;
	var autreEquipeReponse;
	var modeSolution=0;
	var messageVainqueur="";
	var switchOn = false;
	var idChansonsManche = [];
	var binome="";
	var idEquipeAdv;
	var timerFlash = null;
	var flash=0;
	var activeBonus=0;
	var modePreEcoute = 0;
	
	function menu(menuEnCours){
		switch (menuEnCours) {
		  case "accueil":
			console.log("Menu : accueil");
			
			break;
		  case "nomEquipes":
		    console.log("Menu : nomEquipes");
			cacheDiv("accueil");
			afficheDiv("nomEquipes");
			break;
		  case "choixPack":
		    console.log("Menu : choixPack");
			cacheDiv("nomEquipes");
			afficheDiv("infosJeu");
			afficheDiv("choixPack");
			nomEquipe[0] = document.getElementById("nomEq1").value;
			nomEquipe[1] = document.getElementById("nomEq2").value;
			document.getElementById("IJ_nom_equipe2").innerHTML = nomEquipe[1];
			document.getElementById("IJ_nom_equipe1").innerHTML = nomEquipe[0];
			document.getElementById("IJ_pts_equipe1").innerHTML = 0;
			document.getElementById("IJ_pts_equipe2").innerHTML = 0;
			initBonus();
			chargePacks();
			break;
		  case "choixChanson":
			console.log("Menu : choixChanson");
			cacheDiv("choixPack");
			afficheDiv("choixChanson");
			afficheChoixChanson();
			break;
		  case "switch":
			console.log("Menu : switch");
			cacheDiv("choixChanson");
			afficheDiv("proposeSwitch");
			proposeSwitch();
			break;
		  case "choixNiveau":
			console.log("Menu : choixNiveau");
			cacheDiv("choixChanson"); 
			afficheDiv("niveauChanson");
			chargeInfosStop();
			break;
		  case "ecouteChanson":
			console.log("Menu : ecouteChanson");
			cacheDiv("niveauChanson");
			afficheDiv("ecouteChanson");
			afficheEtLanceChanson();
			break;
		  case "reponse":
			console.log("Menu : reponse");
			cacheDiv("menuChanson");
			cacheDiv("ecouteChanson");
			afficheDiv("reponse");
			prepareReponse();
			break;
		  case "verification":
			console.log("Menu : verification");
			cacheDiv("reponse");
			afficheDiv("verification");
			lanceVerification();
			break;
		  case "afficheVainqueur":
			console.log("Menu : afficheVainqueur");
			cacheDiv("verification");
			afficheDiv("chansonSuivante");
			afficherGagnant();
			break;
		  case "chansonSuivante":
			console.log("Menu : chansonSuivante");
			cacheDiv("verification");
			cacheDiv("menuChanson");
			cacheDiv("justeAvant");
			afficheDiv("chansonSuivante");
			afficherGagnant();
			break;
		  case "prochaineSuivante":
			console.log("Menu : prochaineSuivante");
			cacheDiv("chansonSuivante");
			cacheDiv("menuChanson");
			cacheDiv("justeAvant");
			DZ.player.pause();
			chansonSuivante();
			break;
		  case "autre":
			console.log("menu");
			break;
		  default:
			console.log("default");
		}
	}
	
	function chargeInfosStop() {
		var minutes;
		var seconds;
		listeChansons.forEach(element => {
			if (element._id == idChansonEnCours) {
				// ONE STOP
				if (element.timestop1 == element.timestop2) {
					minutes = Math.floor(element.timestop1 / 60);
					seconds = element.timestop1 - minutes * 60;
					seconds = Math.round(seconds * 100) / 100;
					document.getElementById("niv1").innerHTML = "ONE STOP<BR>Stop à " + minutes + ":" + ("0" + Math.round(seconds)).slice(-2);
					document.getElementById("niv2").style.display = 'none';
					document.getElementById("niv3").style.display = 'none';
					document.getElementById("separateurniv2").style.display = 'none';
					document.getElementById("separateurniv3").style.display = 'none';
				} else {
					minutes = Math.floor(element.timestop1 / 60);
					seconds = element.timestop1 - minutes * 60;
					seconds = Math.round(seconds * 100) / 100;
					document.getElementById("niv1").innerHTML = "FACILE (X1)<BR>Stop à " + minutes + ":" + ("0" + Math.round(seconds)).slice(-2);
					minutes = Math.floor(element.timestop2 / 60);
					seconds = element.timestop2 - minutes * 60;
					seconds = Math.round(seconds * 100) / 100;
					document.getElementById("niv2").innerHTML = "MOYEN (X2)<BR>Stop à " + minutes + ":" + ("0" + Math.round(seconds)).slice(-2);
					minutes = Math.floor(element.timestop3 / 60);
					seconds = element.timestop3 - minutes * 60;
					seconds = Math.round(seconds * 100) / 100;
					document.getElementById("niv3").innerHTML = "DIFFICILE (X3)<BR>Stop à " + minutes + ":" + ("0" + Math.round(seconds)).slice(-2);	
				}
			}
		});
	}
	
	function deuxMots(idEq) {
		if ((activeBonus==1) && (idEq == equipeEnCours) && (nbMotsEnCours > 1) && (bonusDeuxMots[idEq] == 1)) {
			activeBonus = 0;
			cacheDiv("reponse");
			afficheDiv("bonus2Mots");
			mot1 = -1;
			mot2 = -1;
			document.getElementById("listeMots").innerHTML = "";
			document.getElementById("btnValider2Mots").classList = "btn btn-default";
			document.getElementById("btnRetourJeuDeuxMotsInitiales").style.display = 'none';
			document.getElementById("btnValider2Mots").style.display = 'block';
			document.getElementById("btnAnnuler2Mots").style.display = 'block';
			var str2 = solutionStop.replace (/'/g, ' ');
			var res = str2.split(" ");
			for(var i = 0; i < res.length; i++) {
				document.getElementById("listeMots").innerHTML += "<button type=\"button\" id=\"MotsN" + i 
				+ "\" onclick=\"selectionMot(" +  i
				+ ")\" class=\"btn btn-default\" style=\"font-size:xx-large\">" + (i+1) + "° Mot</button> ";
			}
		}
	}
	
	function selectionMot(idM) {
		var nomBtn = "MotsN" + idM;
		if ((mot1 != -1) && (mot2 != -1) && (document.getElementById(nomBtn).classList == "btn btn-default")) {
			alert("Vous avez déjà sélectionné 2 mots ! \nPour déselctionné un mot rechoisissez-le.");
		} else {
			if (document.getElementById(nomBtn).classList == "btn btn-default") {
				if (mot1 == -1) {
					mot1 = idM;
				} else {
					mot2 = idM;
				}
				document.getElementById(nomBtn).classList = "btn btn-success";
			} else {
				if (mot1 != -1) {
					mot1 = -1;
				} else {
					mot2 = -1;
				}
				document.getElementById(nomBtn).classList = "btn btn-default";
			}
			if ((mot1 != -1) && (mot2 != -1)) {
				document.getElementById("btnValider2Mots").classList = "btn btn-success";
			} else {
				document.getElementById("btnValider2Mots").classList = "btn btn-default";
			}
		}
	}
	
	function btnValider2Mots2(){
		if (bonusDeuxMots[equipeEnCours] = 1) {
			document.getElementById("listeMots").innerHTML = "";
			var str2 = solutionStop.replace (/'/g, ' ');
			var res = str2.split(" ");
			for(var i = 0; i < res.length; i++) {
				if ((i == mot1) || (i == mot2)) {
					document.getElementById("listeMots").innerHTML += "<button type=\"button\" id=\"MotsN" + i 
					+ "\" class=\"btn btn-success\" style=\"font-size:xx-large\">" + res[i] + "</button> ";
				} else {
					document.getElementById("listeMots").innerHTML += "<button type=\"button\" id=\"MotsN" + i 
					+ "\" class=\"btn btn-default\" style=\"font-size:xx-large\">" + (i+1) + "° Mot</button> ";
				}
			}
			bonusDeuxMots[equipeEnCours] = 0;
			document.getElementById("infoRepChanson").innerHTML = "Saisie " + nbMotsEnCours + " Mot(s)<br>Equipe "+ nomEquipe[equipeEnCours];
			coloreDiv(equipeEnCours, "infoRepChanson");
			document.getElementById("btnRetourJeuDeuxMotsInitiales").style.display = 'block';
			document.getElementById("btnValider2Mots").style.display = 'none';
			document.getElementById("btnAnnuler2Mots").style.display = 'none';
			
		}
	}
	
	function coloreDiv(idEquipe, nomdiv) {
		if (idEquipe == 0) {
			document.getElementById(nomdiv).classList = "btn btn-primary";
		} else {
			document.getElementById(nomdiv).classList = "btn btn-danger";
		}
	}
	
	
	function retourJeuDeuxMotsInitiales2(){
		eteindreBonus(equipeEnCours);
		afficheDiv("reponse");
		cacheDiv("bonus2Mots");
	}
	
	function btnAnnuler2Mots2(){
		activeBonus = 1;
		afficheDiv("reponse");
		cacheDiv("bonus2Mots");
	}
		
	function unmot(idEq) {
		if ((activeBonus==1) && (idEq == equipeEnCours) && (bonusPremierMot[idEq] == 1)) {
			activeBonus = 0;
			cacheDiv("reponse");
			afficheDiv("bonusUNMOTINITIALES");
			document.getElementById("libelleUnMotInitiales").style.display = 'block';
			document.getElementById("libelleUnMotInitiales").innerHTML = "Confirmez l'utilisation du Bonus (équipe adverse ne doit pas regarder)<BR>ou Annulez";
			document.getElementById("btnUnMot").style.display = 'block';
			document.getElementById("btnAnnulerUnMotInitiales").style.display = 'block';
		}
	}
	
	function apeupres(idEq) {
		if ((activeBonus==1) && (idEq == equipeEnCours) && (bonusApeupres[idEq] == 1)) {
			activeBonus = 0;
			cacheDiv("reponse");
			afficheDiv("bonusAPEUPRES");
		}
	}
	
	function initiales(idEq) {
	    if ((activeBonus==1) && (idEq == equipeEnCours) && (bonusInitiales[idEq] == 1)) {
			activeBonus = 0;
			cacheDiv("reponse");
			afficheDiv("bonusUNMOTINITIALES");
			document.getElementById("libelleUnMotInitiales").style.display = 'block';
			document.getElementById("libelleUnMotInitiales").innerHTML = "Confirmez l'utilisation du Bonus (équipe adverse ne doit pas regarder)<BR>ou Annulez";
			document.getElementById("btnInitiales").style.display = 'block';
			document.getElementById("btnAnnulerUnMotInitiales").style.display = 'block';
		}
	}
	
	function retourJeuUnMotInitiales() {
		document.getElementById("btnRetourJeuUnMotInitiales").style.display = 'none';
		document.getElementById("libelleUnMotInitiales").style.display = 'none';
		document.getElementById("reponseUnMotInitiales").style.display = 'none';
		afficheDiv("reponse");
		cacheDiv("bonusUNMOTINITIALES");
	}
	
	function afficheUnMot(){
		if (bonusPremierMot[equipeEnCours] = 1) {
			var str2 = solutionStop.replace (/'/g, ' ');
			var res = str2.split(" ");
			document.getElementById("libelleUnMotInitiales").style.display = 'block';
			document.getElementById("libelleUnMotInitiales").innerHTML = "Le 1er mot est :";
			document.getElementById("btnUnMot").style.display = 'none';
			document.getElementById("btnAnnulerUnMotInitiales").style.display = 'none';
			document.getElementById("reponseUnMotInitiales").style.display = 'block';
			document.getElementById("reponseUnMotInitiales").innerHTML = res[0];
			document.getElementById("btnRetourJeuUnMotInitiales").style.display = 'block';
			bonusPremierMot[equipeEnCours] = 0;
			document.getElementById("infoRepChanson").innerHTML = "Saisie " + nbMotsEnCours + " Mot(s)<br>Equipe "+ nomEquipe[equipeEnCours];
			coloreDiv(equipeEnCours, "infoRepChanson");
			eteindreBonus(equipeEnCours);
			
		}
	}
	
	function afficheInitiales(){
		if (bonusInitiales[equipeEnCours] = 1) {
			var str2 = solutionStop.replace (/'/g, ' ');
			var res = str2.split(" ");
			document.getElementById("libelleUnMotInitiales").style.display = 'block';
			document.getElementById("libelleUnMotInitiales").innerHTML = "Les initiales de chaque mot sont :";
			document.getElementById("reponseUnMotInitiales").style.display = 'block';
			document.getElementById("btnInitiales").style.display = 'none';
			document.getElementById("btnAnnulerUnMotInitiales").style.display = 'none';
			var repInit = "";
			for(var i = 0; i < res.length; i++) {
				repInit += res[i].substring(0,1) + "___ ";
			}
			document.getElementById("reponseUnMotInitiales").innerHTML = repInit;
			document.getElementById("btnRetourJeuUnMotInitiales").style.display = 'block';
			bonusInitiales[equipeEnCours] = 0;
			document.getElementById("infoRepChanson").innerHTML = "Saisie " + nbMotsEnCours + " Mot(s)<br>Equipe "+ nomEquipe[equipeEnCours];
			coloreDiv(equipeEnCours, "infoRepChanson");
			eteindreBonus(equipeEnCours);
			
		}
	}
		
	function annulerUnMotInitiales(){
		activeBonus = 1;
		afficheDiv("reponse");
		document.getElementById("btnUnMot").style.display = 'none';
		document.getElementById("btnInitiales").style.display = 'none';
		cacheDiv("bonusUNMOTINITIALES");
	}
	function confirmerFois2() {
		bonusFoisDeux[equipeEnCours] = 0;
		foisDeuxEncours = equipeEnCours;
		eteindreBonus(equipeEnCours);
		document.getElementById("infoRepChanson").innerHTML = "Saisie " + nbMotsEnCours + " Mot(s)<br>Equipe "+ nomEquipe[equipeEnCours];
		coloreDiv(equipeEnCours, "infoRepChanson");
		cacheDiv("bonusFOIS2");
		afficheDiv("reponse");
	}
	
	function confirmerApeupres() {
		bonusApeupres[equipeEnCours] = 0;
		ApeupresEncours = equipeEnCours;
		eteindreBonus(equipeEnCours);
		document.getElementById("infoRepChanson").innerHTML = "Saisie " + nbMotsEnCours + " Mot(s)<br>Equipe "+ nomEquipe[equipeEnCours];
		coloreDiv(equipeEnCours, "infoRepChanson");
		cacheDiv("bonusAPEUPRES");
		afficheDiv("reponse");
	}
	
	function fois2(idEq) {
		if ((activeBonus==1) && (idEq == equipeEnCours) && (bonusFoisDeux[idEq] == 1)) {
			activeBonus = 0;
			cacheDiv("reponse");
			afficheDiv("bonusFOIS2");
		}
	}
	
	function btnAnnulerFois2() {
		activeBonus = 1;
		cacheDiv("bonusFOIS2");
		afficheDiv("reponse");
	}
	
	function btnAnnulerApeupres() {
		activeBonus = 1;
		cacheDiv("bonusAPEUPRES");
		afficheDiv("reponse");
	}
	
	function resetBtnSwitch(){
		if (idEquipeAdv == 0) {
				document.getElementById("switch_eq1_btn").classList = "w3-btn w3-blue w3-round-xxlarge";
			} else {
				document.getElementById("switch_eq2_btn").classList =  "w3-btn w3-red w3-round-xxlarge";
			}
		cacheDiv("proposeSwitch");
		menu("choixNiveau");
	}
		
	function switche(idEq) {
		if ((switchOn) && (bonusSwitch[idEq] == 1) && (idEq == idEquipeAdv)) {
			var indexSwitch = chansonDejaJouee.indexOf(idChansonEnCours);
			chansonDejaJouee.splice(indexSwitch,1);
			if (idChansonsManche[0] == idChansonEnCours) {
				idChansonEnCours = idChansonsManche[1];
			} else {
				idChansonEnCours = idChansonsManche[0];
			}
			chansonDejaJouee.push(idChansonEnCours);
			majNomChanson(idChansonEnCours);
			bonusSwitch[idEq]=0;
			if (idEq == 0) {
				document.getElementById("switch_eq1_btn").classList = "w3-btn w3-black w3-round-xxlarge w3-disabled";
			} else {
				document.getElementById("switch_eq2_btn").classList = "w3-btn w3-black w3-round-xxlarge w3-disabled";
			}
			cacheDiv("proposeSwitch");
			menu("choixNiveau");
		} else {
			alert("Non jouable !");
		}
		
	}
	
	function majNomChanson(idChanson) {
		listeChansons.forEach(element => {
			if (element._id == idChanson) {
				document.getElementById("infoChansonEncours").innerHTML = "Equipe "+ nomEquipe[equipeEnCours] + "<br><b>" + element.titre + "</b><BR>" + element.artist;
			}
		});
	}
	
	function proposeSwitch() {
		var theChanson;
		var theChanson2;
		var idChansonDeux = 0;
		if (idEquipeAdv == 0) {
			document.getElementById("switch_eq1_btn").classList = "w3-btn w3-green";
		} else {
			document.getElementById("switch_eq2_btn").classList = "w3-btn w3-green";
		}
		
		document.getElementById("libelleSwitch").innerHTML = "L'équipe " + nomEquipe[equipeEnCours] + 
		" a choisi la chanson suivante :";
		coloreDiv(equipeEnCours, "libelleSwitch");
		document.getElementById("libelleSwitch2").innerHTML = "Equipe " + nomEquipe[idEquipeAdv] + 
		" voulez-vous SWITCHER ou garder celle ci-dessous ?<BR>(Si oui appuyez sur votre Bonus)";
		coloreDiv(idEquipeAdv, "libelleSwitch2");
		
		for(var i = 0; i < 2; i++) {
			if (idChansonEnCours !== idChansonsManche[i]) {
				idChansonDeux = idChansonsManche[i];
			}
		}
		listeChansons.forEach(element => {
			if (element._id == idChansonEnCours) {
				//idTrackEnCours = element.idDeezer;
				theChanson = "<div class=\"w3-tag w3-round w3-red\" style=\"padding:3px\" >" +
					"<div class=\"w3-tag w3-round w3-yellow w3-border w3-border-white\" style=\"font-size:xx-large\">" +
					"<b>" + element.titre + "</b><BR>" + element.artist + "</div></div>";
			} else if (element._id == idChansonDeux) {
				//idTrackEnCours = element.idDeezer;
				theChanson2 = "<div class=\"w3-tag w3-round w3-red\" style=\"padding:3px\" >" +
					"<div class=\"w3-tag w3-round w3-yellow w3-border w3-border-white\" style=\"font-size:xx-large\">" +
					"<b>" + element.titre + "</b><BR>" + element.artist + "</div></div>";
			}
		});
		document.getElementById("chansonSwitch").innerHTML = theChanson;
		document.getElementById("chansonSwitch2").innerHTML = theChanson2;
	}
	
	function bonnereponse(idR) {
		if (idR == -1) {
			messageVainqueur = "Pas de vainqueur sur cette chanson";
			foisDeuxEncours = -1;
			ApeupresEncours = -1;
			menu("chansonSuivante");
		} else {
			if (foisDeuxEncours == idR) {
				ptsEquipe[idR] = ptsEquipe[idR] + (ptsEnCours*2);
			} else {
				ptsEquipe[idR] = ptsEquipe[idR] + ptsEnCours;
			}
			
			if (idR == 0) {
				document.getElementById("IJ_pts_equipe1").innerHTML = ptsEquipe[idR];
			} else {
				document.getElementById("IJ_pts_equipe2").innerHTML = ptsEquipe[idR];
			}
			if (foisDeuxEncours == idR) {
				messageVainqueur = "L'équipe " + nomEquipe[idR] + " marque " + (ptsEnCours*2) +
				" pts (" + ptsEnCours + "X2) avec le Bonus X2";
			} else {
				messageVainqueur = "L'équipe " + nomEquipe[idR] + " marque " + ptsEnCours + " pts";
			}
			if (idR == 0) {
				messageVainqueur = "<font color='#337ab7'>" + messageVainqueur + "</font>";
			} else {
				messageVainqueur = "<font color='#c9302c'>" + messageVainqueur + "</font>";
			}
			foisDeuxEncours = -1;
			ApeupresEncours = -1;
			menu("chansonSuivante");
		}
	}
	
	function chansonSuivante() {
		modeSolution = 0; // pour réactiver les stops
		reponses[0] = "";
		reponses[1] = "";
		document.getElementById("btnRep1").style.display = 'none';
		document.getElementById("btnRep").style.display = 'none';
		document.getElementById("btnRep2").style.display = 'none';
		document.getElementById("infoRep").style.display = 'none';
		document.getElementById("infoRep").innerHTML = "";
		if (equipeEnCours == 0) {
			equipeEnCours = 1;
		} else {
			equipeEnCours = 0;
		}
		menu("choixChanson");
	}
	
	function afficherGagnant() {
		stopEnCours = 1000;
		document.getElementById("infoGagnant").innerHTML = messageVainqueur;
	}
	
	function lanceVerification(){
		let texteBonus = "";
		if (ApeupresEncours != -1)
		{ texteBonus = "<BR>BONUS 'A PEU PRES' EN COURS !" }
		if (equipeEnCours == 0) {
			document.getElementById("infoRep1").innerHTML = "<span class='glyphicon glyphicon-hand-right'></span>Equipe "+ nomEquipe[0] + "<BR>" + reponses[0] + texteBonus;
			document.getElementById("infoRep2").innerHTML = "Equipe "+ nomEquipe[1] + "<BR>" + reponses[1];
		} else {
			document.getElementById("infoRep1").innerHTML = "Equipe "+ nomEquipe[0] + "<BR>" + reponses[0];
			document.getElementById("infoRep2").innerHTML = "Equipe "+ nomEquipe[1] + "<span class='glyphicon glyphicon-hand-left'></span><BR>" + reponses[1] + texteBonus;
		}
		
		modeSolution = 1;
		rewind();
		// btnRep1/btnRep/btnRep2/infoRep
		//document.getElementById(idDiv).style.display = 'block';
	
	}
	
	function afficheSolution() {
		document.getElementById("btnRep1").style = 'display: inline; visibility: visible';
		document.getElementById("btnRep").style.display = 'block';
		document.getElementById("btnRep2").style = 'display: inline; visibility: visible';
		document.getElementById("infoRep").style.display = 'block';
		document.getElementById("infoRep").innerHTML = solutionStop;
	}
	
	function prepareReponse() {
		document.getElementById("infoRepChanson").innerHTML = "Saisie " + nbMotsEnCours + " Mot(s)<br>Equipe "+ nomEquipe[equipeEnCours];
		coloreDiv(equipeEnCours, "infoRepChanson");
		reponses = [];
		reponses.push("");
		reponses.push("");
		autreEquipeReponse=equipeEnCours;
		if (autreEquipeReponse == equipeEnCours) {
			if ((bonusDeuxMots[equipeEnCours] == 1) && (nbMotsEnCours>1)) {
				nomIdBtn = "deuxmots_eq" + (equipeEnCours+1) + "_btn"
				document.getElementById(nomIdBtn).classList = "w3-btn w3-green";
				activeBonus=1;
			}
			if (bonusInitiales[equipeEnCours] == 1) {
				nomIdBtn = "initiales_eq" + (equipeEnCours+1) + "_btn"
				document.getElementById(nomIdBtn).classList = "w3-btn w3-green";
				activeBonus=1;
			}
			if (bonusFoisDeux[equipeEnCours] == 1) {
				nomIdBtn = "fois2_eq" + (equipeEnCours+1) + "_btn"
				document.getElementById(nomIdBtn).classList = "w3-btn w3-green";
				activeBonus=1;
			}
			if (bonusPremierMot[equipeEnCours] == 1) {
				nomIdBtn = "unmot_eq" + (equipeEnCours+1) + "_btn"
				document.getElementById(nomIdBtn).classList = "w3-btn w3-green";
				activeBonus=1;
			}
			if (bonusApeupres[equipeEnCours] == 1) {
				nomIdBtn = "apeupres_eq" + (equipeEnCours+1) + "_btn"
				document.getElementById(nomIdBtn).classList = "w3-btn w3-green";
				activeBonus=1;
			}
			if (activeBonus == 1) {
				document.getElementById("infoRepChanson").innerHTML += "<BR>Des bonus (en vert) sont disponibles<BR>(1 seul par chanson)";
			}
		}
	}
	
	function bloqueParoles() {
		var activeBonus=0;
		var nomIdBtn;
		if ((reponses[0] !== "") && (reponses[1] !== "")) {
			// saisie terminee
			menu("verification");
		} else {
			if (document.getElementById("repEq").value == "") {
				reponses[autreEquipeReponse] = "pas de réponse";
			} else {
				reponses[autreEquipeReponse] = document.getElementById("repEq").value;
			}
			
			eteindreBonus(autreEquipeReponse);
			if (autreEquipeReponse == 0) {
				autreEquipeReponse = 1; 
			} else {
				autreEquipeReponse = 0;
			}
			if ((reponses[0] !== "") && (reponses[1] !== "")) {
				// saisie terminee
				document.getElementById("repEq").value = "";
				menu("verification");
			} else {
				document.getElementById("infoRepChanson").innerHTML = "Saisie " + nbMotsEnCours + " Mot(s)<br>Equipe "+ nomEquipe[autreEquipeReponse];
				coloreDiv(autreEquipeReponse, "infoRepChanson");
				document.getElementById("repEq").value = "";
			}
		}
	}
	
	function eteindreBonus(idJ) {
		
		if (bonusDeuxMots[idJ] == 1) {
			nomIdBtn = "deuxmots_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = (idJ == 0) ? "w3-btn w3-blue w3-round-xxlarge" : "w3-btn w3-red w3-round-xxlarge";
		} else {
			nomIdBtn = "deuxmots_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = "w3-btn w3-black w3-round-xxlarge w3-disabled";
		}
		if (bonusInitiales[idJ] == 1) {
			nomIdBtn = "initiales_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = (idJ == 0) ? "w3-btn w3-blue w3-round-xxlarge" : "w3-btn w3-red w3-round-xxlarge";
		} else {
			nomIdBtn = "initiales_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = "w3-btn w3-black w3-round-xxlarge w3-disabled";
		}
		if (bonusFoisDeux[idJ] == 1) {
			nomIdBtn = "fois2_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = (idJ == 0) ? "w3-btn w3-blue w3-round-xxlarge" : "w3-btn w3-red w3-round-xxlarge";
		} else {
			nomIdBtn = "fois2_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = "w3-btn w3-black w3-round-xxlarge w3-disabled";
		}
		if (bonusPremierMot[idJ] == 1) {
			nomIdBtn = "unmot_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = (idJ == 0) ? "w3-btn w3-blue w3-round-xxlarge" : "w3-btn w3-red w3-round-xxlarge";
		} else {
			nomIdBtn = "unmot_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = "w3-btn w3-black w3-round-xxlarge w3-disabled";
		}
		if (bonusApeupres[idJ] == 1) {
			nomIdBtn = "apeupres_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = (idJ == 0) ? "w3-btn w3-blue w3-round-xxlarge" : "w3-btn w3-red w3-round-xxlarge";
		} else {
			nomIdBtn = "apeupres_eq" + (idJ+1) + "_btn"
			document.getElementById(nomIdBtn).classList = "w3-btn w3-black w3-round-xxlarge w3-disabled";
		}
	}	
	
	function afficheEtLanceChanson() {
		var theChanson;
		
		listeChansons.forEach(element => {
			if (element._id == idChansonEnCours) {
				idTrackEnCours = element.idDeezer;
				if (niveauEnCours == 1) {
					stopEnCours = element.timestop1;
					solutionStop = element.lyricsstop1;
					motsAvantStop = element.avantStop1;
				}
				if (niveauEnCours == 2) {
					stopEnCours = element.timestop2;
					solutionStop = element.lyricsstop2;
					motsAvantStop = element.avantStop2;
				}
				if (niveauEnCours == 3) {
					stopEnCours = element.timestop3;
					solutionStop = element.lyricsstop3;
					motsAvantStop = element.avantStop3;
				}
				theChanson = "<div class=\"w3-tag w3-round w3-red\" style=\"padding:3px\" >" +
					"<div class=\"w3-tag w3-round w3-yellow w3-border w3-border-white\" style=\"font-size:xx-large\">" +
					"<b>" + element.titre + "</b><BR>" + element.artist + "</div></div><div class=\"separateur\">&nbsp;</div>";
				document.getElementById("justeAvant").innerHTML = motsAvantStop + "...";	
			}
		});
		
		var minInfo = Math.floor(stopEnCours / 60);
		var secInfo = stopEnCours - minInfo * 60;
		secInfo = Math.round(secInfo * 100) / 100;
		var tmpsStopInfo = minInfo + ":" + ("0" + Math.round(secInfo)).slice(-2);
		document.getElementById("infoChanson").innerHTML = nbMotsEnCours + " Mot(s) - " + ptsEnCours + " pt(s)<br>" + 
		"Stop à " + tmpsStopInfo + "<br>Equipe " + nomEquipe[equipeEnCours];
		coloreDiv(equipeEnCours, "infoChanson");
		document.getElementById("laChanson").innerHTML = theChanson;
		modePreEcoute = 0;
		var tableauD = [idTrackEnCours];
		DZ.player.playTracks(tableauD);
	}
	
	function afficheChoixChanson() {
		binome="";
		var cptNbChanson = 0;
		idChansonsManche = [];
		listeChansons.forEach(element => {
			console.log(element);
			var dejaJoue = chansonDejaJouee.find(item => item == element._id);
			if ((parseInt(element.nbMotsStop) === nbMotsEnCours) && (dejaJoue == undefined)) {
				cptNbChanson++;
				document.getElementById("nbMots").innerHTML = "Manche " + nbManchesEncours + "/" + nbManches + "<BR>" + nbMotsEnCours + " Mot(s) - " + nbMotsEnCours + " pt(s)<br>Equipe "+ nomEquipe[equipeEnCours];
				var preEcouteId = "preEcoute" + cptNbChanson;
				binome += "<div class=\"w3-tag w3-round w3-darkgray\" style=\"padding:3px\" onclick=\"selectionChanson('" + element._id + "')\">" +
					"<div class=\"w3-tag w3-round w3-green w3-border w3-border-white\" style=\"font-size:xx-large\">" +
					"<b>" + element.titre + "</b><BR>" + element.artist + "</div>" +
					"</div><div id=\"" + preEcouteId + "\" onclick=\"preecouteChanson('" + element._id + "')\"><img style=\"width:200px\" src=\"preload.png\"></div><div class=\"separateur\">&nbsp;</div>";
				idChansonsManche.push(element._id);
				coloreDiv(equipeEnCours, "nbMots");
			}
			
		});
		
		if (binome == "") {
			//prochain niveau
			nbMotsEnCours++;
			if (equipeEnCours == 0) {
				equipeEnCours = 1;
			} else {
				equipeEnCours = 0;
			}
			if (nbMotsEnCours>10) {
				// FIN PARTIE
				if (ptsEquipe[0]>ptsEquipe[1]) {
					document.getElementById("nbMots").innerHTML = "C'est l'équipe " + nomEquipe[0] + " qui gagne la partie !";
					coloreDiv(0, "nbMots");
				} else if (ptsEquipe[0]<ptsEquipe[1]) {
					document.getElementById("nbMots").innerHTML = "C'est l'équipe " + nomEquipe[1] + " qui gagne la partie !";
					coloreDiv(0, "nbMots");
				} else {
					document.getElementById("nbMots").innerHTML = "Egalité parfaite ! Refaites-en une !";
				}
				document.getElementById("listeChansons").innerHTML = "<button class='btn btn-primary btn-lg' onclick='window.location.reload();'>Nouvelle Partie</button>";
			} else {
				switchOn = true;
				menu("choixChanson");
			}
		} else {
			document.getElementById("listeChansons").innerHTML = binome;
			if (cptNbChanson == 1) {
				nbManchesEncours++;			
				switchOn = false;
				var preEcouteId = "preEcoute" + 1;
				document.getElementById(preEcouteId).style.display = 'none';
			} else {
				for(var i = 1; i < cptNbChanson+1; i++) {
					var preEcouteId = "preEcoute" + i;
					document.getElementById(preEcouteId).style.display = 'block';
				}
				switchOn = true;
			}
		}
		
	}
	
	function preecouteChanson(idChanson) {
		console.log(idChanson);
		listeChansons.forEach(element => {
			if (element._id == idChanson) {
				idTrackEnCours = element.idDeezer;
				stopEnCours = element.timestop1;
				modePreEcoute = 1;
				var tableauD = [idTrackEnCours];
				DZ.player.playTracks(tableauD);
			}
		})
	}
	
	function selectionChanson(idChanson) {
		console.log(idChanson);
		chansonDejaJouee.push(idChanson);
		majNomChanson(idChanson);
		idChansonEnCours = idChanson;
		if (equipeEnCours == 0){
			idEquipeAdv = 1;
		} else {
			idEquipeAdv = 0;
		}
		if ((switchOn) && (bonusFoisDeux[idEquipeAdv] == 1)){
			menu("switch");
		} else { 
			menu("choixNiveau");
		}
	}
	
	function choixNiveau(niveau) {
		niveauEnCours = niveau;
		ptsEnCours = niveau * nbMotsEnCours;
		menu("ecouteChanson");
		switchOn = false;
	}
	
	function initBonus() {
		bonusFoisDeux[0] = 1;
		bonusFoisDeux[1] = 1;
		bonusSwitch[0] = 1;
		bonusSwitch[1] = 1;
		bonusInitiales[0] = 1;
		bonusInitiales[1] = 1;
		bonusPremierMot[0] = 1;
		bonusPremierMot[1] = 1;
		bonusDeuxMots[0] = 1;
		bonusDeuxMots[1] = 1;
		bonusApeupres[0] = 1;
		bonusApeupres[1] = 1;
	}
	
	function chargePacks() {
		var listePacks = "";
		var idCouleur = 0;
		var nomCouleur = "";
		for(var i = 0; i < allThemes.length-1; i++) {
			if (idCouleur == 0) {
				nomCouleur = "btn btn-primary";
			}
			if (idCouleur == 1) {
				nomCouleur = "btn btn-secondary";
			}
			if (idCouleur == 2) {
				nomCouleur = "btn btn-success";
			}
			if (idCouleur == 3) {
				nomCouleur = "btn btn-danger";
			}
			if (idCouleur == 4) {
				nomCouleur = "btn btn-warning";
			}
			if (idCouleur == 5) {
				nomCouleur = "btn btn-info";
			}
			if (idCouleur == 6) {
				nomCouleur = "btn btn-dark";
			}
			if ((i>0) && ((i % 2) == 0)){
				listePacks += "<div class='separateur'>&nbsp;</div>";
			} else {
				if (i>0) {
					listePacks += "&nbsp;&nbsp;";
				}
			}
			listePacks += "<button type='button' class='" + nomCouleur + 
			"' onclick=\"choixDuPack('" + allThemes[i] + 
			"')\" style='font-size:xx-large'>" + allThemes[i] + 
			"<BR>" + (infosPack[i]/2) + " manches</button>";
			
			idCouleur++;
			if (i>6) { idCouleur = 0;}
		}
		
		document.getElementById("listeDesPacks").innerHTML = listePacks;
	}
	
	function choixDuPack(nomPack) {
		nomPackEnCours = nomPack;
		allRecords.forEach(element => trierTheme(element));
		var nbCh = 0;
		function trierTheme(element){
			if (element.theme == nomPack){
				nbCh++;
				listeChansons.push(element);
			}
		}	
		
		listeChansons.sort(function(a, b) {
		  var keyA = a.nbMotsStop,
			keyB = b.nbMotsStop;
		  // Compare the 2 dates
		  if (keyA < keyB) return -1;
		  if (keyA > keyB) return 1;
		  return 0;
		});
		console.log ("liste des chansons du pack '" + nomPack + "' = ");
		console.log (listeChansons);
		nbManches = (listeChansons.length/2);
		menu("choixChanson");
	}
	
	function rewind() {
		var coef = 100/tps;
		var pourcentage = (tpsencours-15) * coef;
		if (pourcentage<0) {pourcentage = 0};
		DZ.player.seek(pourcentage);
	}
	
	$(document).ready(function(){
		$("#controlers input").attr('disabled', true);
		$("#slider_seek").click(function(evt,arg){
			var left = evt.offsetX;
			DZ.player.seek((evt.offsetX/$(this).width()) * 100);
		});
		//Appending HTML5 Audio Tag in HTML Body
		$('<audio id="chatAudio"><source src="jingle.mp3" type="audio/mpeg"></audio>').appendTo('body');
	});
	function event_listener_append() {
		var pre = document.getElementById('timer');
		var minutes = Math.floor(arguments[1] / 60);
		var seconds = arguments[1] - minutes * 60;
		seconds = Math.round(seconds * 100) / 100;
		pre.innerHTML = minutes + ":" + ("0" + Math.round(seconds)).slice(-2);
		if (modePreEcoute == 1) {
			if (arguments[1]>=parseInt(5)){
				console.log("stop superieur ou egal à 5 (préécoute)");
				DZ.player.pause();
			}
		} else if (modeSolution == 1) {
			if (arguments[1]>=parseInt(stopEnCours)){
				afficheSolution();
			}
		} else {
			if ((arguments[1]>=parseInt(stopEnCours-5)) && (arguments[1]<parseInt(stopEnCours-4))){
				//$('#chatAudio')[0].play();
				timerFlash = self.setTimeout("lightning()",1);
			}
			
			if (arguments[1]==parseInt(stopEnCours)){
				console.log("stop strictement egal");
				DZ.player.pause();
				afficheDiv("menuChanson");
				afficheDiv("justeAvant");
			}
			if (arguments[1]>=parseInt(stopEnCours)){
				console.log("stop superieur ou egal");
				DZ.player.pause();
				afficheDiv("menuChanson");
				afficheDiv("justeAvant");
			}
		}
		
	}
	function lightning()
	{
		flash=flash+1;
		if(flash==1){document.getElementById('titres-form').style = "background-color:red"; setTimeout("lightning()",100);}
		if(flash==2){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==3){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==4){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==5){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==6){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==7){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==8){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==9){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==10){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==11){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==12){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==13){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==14){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==15){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==16){document.getElementById('titres-form').style = "background-color:white"; timerFlash =setTimeout("lightning()",90);}
		if(flash==17){document.getElementById('titres-form').style = "background-color:red"; timerFlash =setTimeout("lightning()",100);}
		if(flash==18){document.getElementById('titres-form').style = "background-color:white";flash=0;clearTimeout(timerFlash)}
		}
	
	function onPlayerLoaded() {
		$("#controlers input").attr('disabled', false);
		event_listener_append('player_loaded');
		DZ.Event.subscribe('current_track', function(arg){
			event_listener_append('current_track', arg.index, arg.track.title, arg.track.album.title);
		});
		DZ.Event.subscribe('player_position', function(arg){
			tps= arg[1];
			tpsencours = arg[0]; 
			event_listener_append('position', arg[0], arg[1]);
			$("#slider_seek").find('.bar').css('width', (100*arg[0]/arg[1]) + '%');
		});
	}
	
	DZ.init({
		appId  : '8',
		channelUrl : 'http://developers.deezer.com/examples/channel.php',
		player : {
			container : 'player',
			cover : true,
			playlist : true,
			width : 650,
			height : 100,
			onload : onPlayerLoaded
		}
	});
	
	
	function init() {
	
	 // put your own error messages and/or message translation logic here
	 
	 var errorMessages = {
		"REQUIRED": "This field is required",
		"UNIQUE": "This value already exists",
		"TYPE": "Invalid data type",
		"REGEX":"Invalid data format",
		"number": "Must be an integer number",
		"money": "Must be a number with max two decimals",
		"JSON":"Not a valid JSON",
		"float_number":"Must be a decimal number",
		"email": "Must be a valid email",
		"FILESIZE": "Upload exceeds file size limit per field (max 1 MB)",
		"UPLOADERROR": "Unable to upload file, please try again",
		"GENERIC_ERROR": "A server error occured, please reload page"
	  }
	var apikey = "fc15604b765756181951a03f7196297f43ff8"; // TODO: INSERT YOUR CORS API KEY HERE OR add formapikey to settings
  
	  if (!apikey) alert("Please insert a CORS API key");
	  
	  var ajaxSettings = {
		"async": true,
		"crossDomain": true,
		"url": "https://cors-anywhere.herokuapp.com/https://goldenmic-0ff1.restdb.io/rest/titres?h={\"$orderby\": {\"theme\": 1, \"artist\": 1}}",
		"method": "GET",
		"headers": {
		  "x-apikey": apikey,
		  "content-type": "application/json"
		},
		"processData": false
	  }
	$.ajax(ajaxSettings)
	.done(function (response) {
		
		cacheDiv("chargement");
		afficheDiv("accueil");
				
		console.log(response);
		var infoPresence = "";
		
		response.forEach(element => controlerPresence(element));
		
		function controlerPresence(element){
			themeEncours = element.theme;
			var trouve = allThemes.find(theme => theme == element.theme);
			if (trouve == undefined) {
				allThemes.push(themeEncours);
			}
			allRecords.push(element);
		}
		
		allRecords.sort(function(a, b) {
		  var keyA = a.theme,
			keyB = b.theme;
		  // Compare the 2 dates
		  if (keyA < keyB) return -1;
		  if (keyA > keyB) return 1;
		  return 0;
		});
		
		console.log(allRecords);
		console.log(allThemes);
		chargeInfosPack();
	})
	.fail(function (response) {
		console.log(response);
	});
}; // init
	
	function chargeInfosPack() {
		var nomduPack;
		var nbChansons = 0;
		for(var i = 0; i < allThemes.length; i++) {
			nbChansons = 0;
			nomduPack = allThemes[i];
			allRecords.forEach(element => compterChansons(element, nomduPack));
			infosPack.push(nbChansons);
		}
		
		function compterChansons(element, nom){
			if (element.theme == nom){
				nbChansons++;
			}
		}	
	}
	
	function afficheDiv(idDiv){
			divEncours = idDiv;
			document.getElementById(idDiv).style.display = 'block';
	}
	function cacheDiv(idDiv){
			document.getElementById(idDiv).style.display = 'none';
	}
</script>
</form>
</body>
